<div class="logs-action-container">

  <div class="table-virtual-scroll">

    <div class="filters-container logs-filters ">
      <div class="active-filters-row">
        <button class="add-filters" mat-flat-button (click)="filtersState.open=true" [disabled]="filtersState.open"> <!--*ngIf="!filtersState.open"-->
          <span>
            <svg-icon icon="filter"></svg-icon>
            {{filtersState.open ? 'Active Filters' : 'ADD FILTER'}}
          </span>
        </button>

<!--        <button *ngFor="let filter of activeFilters" class="filters-field-btn"-->
<!--                mat-flat-button (click)="filterType(filter)"> &lt;!&ndash;(click)="selectFilter(availableField)"&ndash;&gt;-->
<!--          <span>-->
<!--            {{filter}}-->
<!--            <svg-icon icon="close"></svg-icon>-->
<!--          </span>-->
<!--        </button>-->
      </div>

      <mat-accordion class="filters-accordion">
        <mat-expansion-panel [expanded]="filtersState.open" hideToggle="true">
          <ng-template matExpansionPanelContent class="filters-content">
            <div class="filters-row">
              <button class="close-filters-btn" mat-flat-button (click)="filtersState.open=false">
                <span>
                  <svg-icon icon="close"></svg-icon>
                </span>
              </button>

              <span class="filters-label">
                Available Filters
              </span>

              <button *ngFor="let filter of filtersState.availableFields" class="filters-field-btn"
                      mat-flat-button (click)="filterType(filter)"
                      [class.active]="virtualScrollItems.filter[filter]"> <!--(click)="selectFilter(availableField)"-->
                <span>
                  {{filter}}
                  <svg-icon icon="{{virtualScrollItems.filter[filter] ? 'close' : 'add-circle'}}"></svg-icon>
                </span>
              </button>
            </div>
          </ng-template>
        </mat-expansion-panel>
      </mat-accordion>

    </div>

    <div class="table-virtual-scroll-header">
      <span class="logs-action-table-datetime">DATETIME</span>
      <span class="logs-action-table-level">LEVEL</span>
      <span class="logs-action-table-message">MESSAGE</span>
    </div>

    <div style="display:flex;flex-direction: row;">

      <div class="virtual-scroll-container">
        <ng-template vsFor let-event [vsForOf]="virtualScrollItems" let-position="position"
                     (getItems)="getItems($event)" (startStopDataStream)="startStopDataStream($event)">
          <span class="virtualScrollRow" [style.transform]="'translate(0px,' + position + 'px)'"
                [class.virtualScrollRowEven]="event.index % 2">
            <!--                          (mouseenter)="tableMouseEnter(event)">-->

            <span class="item-loading" [class.displayed]="!event?.datetime">&nbsp;</span>

            <span class="truncate">{{event?.datetime}}</span>
            <span class="truncate">{{event?.level}}</span>
            <span class="truncate">{{event?.preview}}</span>

          </span>
        </ng-template>
      </div>

      <div class="logs-action-table-detail">
        <div *ngIf="logsActionItem?.message">
          <ngx-json-viewer [json]="{message:logsActionItem?.message}" [expanded]="true">
          </ngx-json-viewer>
        </div>
      </div>
    </div>

    <!--
    <div class="table-virtual-scroll-panel" style="display:flex;flex-direction: row;">

        <cdk-virtual-scroll-viewport style="align-items: flex-start;" class="logs-action-table-viewport"
            (scrolledIndexChange)="onScroll($event)"
            [itemSize]="36" [maxBufferPx]="288" [minBufferPx]="288">

            <div *cdkVirtualFor="let even=even;let item of logsDataSource"  class="table-virtual-scroll-item"
                (mouseenter)="tableMouseEnter(item)"
                [class.even]="even"
                [class.hover]="item?.id === logsActionItem?.id">

                <span class="logs-action-table-datetime">{{item?.datetime}}</span>
                <span class="logs-action-table-level">{{item?.level}}</span>
                <span class="logs-action-table-message" style="white-space: nowrap; text-overflow: ellipsis;font-size:14px !important;">{{item?.preview}}</span>
            </div>
        </cdk-virtual-scroll-viewport>

        <div class="logs-action-table-detail">
            <div *ngIf="logsActionItem?.message">

                <ngx-json-viewer [json]="{message:logsActionItem?.message}" [expanded]="true">
                </ngx-json-viewer>

            </div>
        </div>

    </div>

    -->
    <div class="table-virtual-scroll-footer">
      <span>
        <button mat-icon-button matTooltip="Start" (click)="scrollStart(null)" *ngIf="!virtualScrollItems?.stream">
          <mat-icon>play_arrow_outline</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Stop" (click)="scrollStop()" *ngIf="virtualScrollItems?.stream">
          <mat-icon>stop_outline</mat-icon>
        </button>
        <button mat-icon-button style="transform: rotate(90deg)" matTooltip="Last page" (click)="scrollToEnd()">
          <mat-icon>last_page</mat-icon>
        </button>
      </span>
    </div>
  </div>

</div>
